<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="colaborador">

    <!-- ============================= -->
    <!-- INSERTAR                      -->
    <!-- ============================= -->
    <insert id="insertar-colaborador" parameterType="pojo.Colaborador">
        INSERT INTO Colaborador( 
        noPersonal, nombre, apellidoPaterno, apellidoMaterno,  
        curp, correo, telefono, foto, password, numeroLicencia, 
        idRol, idSucursal
        ) 
        VALUES ( 
        #{noPersonal}, #{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, 
        #{curp}, #{correo}, #{telefono}, #{foto}, #{password}, 
        #{numeroLicencia}, #{idRol}, #{idSucursal}
        )
    </insert>

    <!-- ============================= -->
    <!-- ACTUALIZAR                    -->
    <!-- ============================= -->
    <update id="actualizar-colaborador" parameterType="pojo.Colaborador">
        UPDATE Colaborador 
        SET 
        nombre = #{nombre}, 
        apellidoPaterno = #{apellidoPaterno}, 
        apellidoMaterno = #{apellidoMaterno}, 
        curp = #{curp}, 
        telefono = #{telefono}, 
        foto = #{foto},  
        password = #{password},  
        numeroLicencia = #{numeroLicencia}, 
        idSucursal = #{idSucursal} 
        WHERE idColaborador = #{idColaborador}
    </update>

    <!-- ============================= -->
    <!-- ELIMINAR                      -->
    <!-- ============================= -->
    <delete id="eliminar-colaborador" parameterType="int">
        DELETE FROM Colaborador 
        WHERE idColaborador = #{idColaborador}
    </delete>

    <!-- ============================= -->
    <!-- BUSCAR POR NOMBRE             -->
    <!-- ============================= -->
    <select id="buscar-por-nombre" parameterType="string" resultType="pojo.Colaborador">
        SELECT * 
        FROM Colaborador 
        WHERE nombre LIKE CONCAT('%', #{_parameter}, '%') 
    </select>

    <!-- ============================= -->
    <!-- BUSCAR POR NO PERSONAL        -->
    <!-- ============================= -->
    <select id="buscar-por-noPersonal" parameterType="string" resultType="pojo.Colaborador">
        SELECT * 
        FROM Colaborador 
        WHERE noPersonal = #{noPersonal}
    </select>

    <!-- ============================= -->
    <!-- BUSCAR POR ROL                -->
    <!-- ============================= -->
    <select id="buscar-por-rol" parameterType="int" resultType="pojo.Colaborador">
        SELECT * 
        FROM Colaborador 
        WHERE idRol = #{idRol}
    </select>

    <!-- ============================= -->
    <!-- ACTUALIZAR PERFIL (MÃ³vil)     -->
    <!-- ============================= -->
    <update id="actualizar-perfil" parameterType="pojo.Colaborador">
        UPDATE Colaborador 
        SET 
        nombre = #{nombre}, 
        apellidoPaterno = #{apellidoPaterno}, 
        apellidoMaterno = #{apellidoMaterno}, 
        telefono = #{telefono}, 
        foto = #{foto}, 
        password = #{password} 
        WHERE idColaborador = #{idColaborador} 
    </update>

    <!-- ============================= -->
    <!-- ASIGNAR UNIDAD A CONDUCTOR    -->
    <!-- ============================= -->
    <update id="asignar-unidad-conductor" parameterType="map">
        UPDATE Unidad 
        SET idColaborador = #{idColaborador} 
        WHERE idUnidad = #{idUnidad} 
    </update>

    <!-- ============================= -->
    <!-- DESASIGNAR UNIDAD             -->
    <!-- ============================= -->
    <update id="desasignar-unidad-conductor" parameterType="map">
        UPDATE Unidad 
        SET idColaborador = NULL 
        WHERE idColaborador = #{idColaborador}
    </update>

    <!-- ============================= -->
    <!-- HISTORIAL UNIDAD-CONDUCTOR    -->
    <!-- ============================= -->
    <insert id="insertar-historial-conductor-unidad" parameterType="map">
        INSERT INTO ConductorUnidad ( 
        idColaborador, idUnidad, fechaAsignacion, activo 
        ) 
        VALUES ( 
        #{idColaborador}, #{idUnidad}, NOW(), 1 
        ) 
    </insert>

    <update id="cerrar-historial-conductor-unidad" parameterType="map">
        UPDATE ConductorUnidad 
        SET activo = 0, 
        fechaDesasignacion = NOW() 
        WHERE idColaborador = #{idColaborador} 
        AND activo = 1 
    </update>

    <!-- ============================= -->
    <!-- LOGIN                         -->
    <!-- ============================= -->
    <select id="login-colaborador" parameterType="map" resultType="pojo.Colaborador">
        SELECT 
        idColaborador, noPersonal, nombre, apellidoPaterno, apellidoMaterno, 
        curp, correo, telefono, foto, numeroLicencia, 
        idRol, idSucursal 
        FROM Colaborador 
        WHERE noPersonal = #{noPersonal} 
        AND password = #{password} 
    </select>

</mapper>
