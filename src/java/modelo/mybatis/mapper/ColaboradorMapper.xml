<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="colaborador">
    
    <!-- ============================= -->
    <!-- OBTENER TODOS                 -->
    <!-- ============================= -->
    <select id="obtener-todos" resultType="dto.ColaboradorTablaDTO">
        SELECT c.idColaborador, c.noPersonal, c.nombre, c.apellidoPaterno, c.apellidoMaterno, 
        c.correo, c.telefono,  
        c.idRol, r.nombre AS nombreRol, 
        c.idSucursal, s.nombre AS nombreSucursal, 
        c.numeroLicencia, c.curp 
        FROM Colaborador c 
        INNER JOIN Rol r ON c.idRol = r.idRol 
        INNER JOIN Sucursal s ON c.idSucursal = s.idSucursal 
        ORDER BY c.noPersonal  
    </select>

    <!-- ============================= -->
    <!-- INSERTAR                      -->
    <!-- ============================= -->
    <insert id="insertar-colaborador" parameterType="pojo.Colaborador">
        INSERT INTO Colaborador( 
        noPersonal, nombre, apellidoPaterno, apellidoMaterno,  
        curp, correo, telefono, foto, password, numeroLicencia, 
        idRol, idSucursal
        ) 
        VALUES ( 
        #{noPersonal}, #{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, 
        #{curp}, #{correo}, #{telefono}, #{foto}, #{password}, 
        #{numeroLicencia}, #{idRol}, #{idSucursal}
        )
    </insert>

    <!-- ============================= -->
    <!-- ACTUALIZAR                    -->
    <!-- ============================= -->
    <update id="actualizar-colaborador" parameterType="pojo.Colaborador">
        UPDATE Colaborador 
        <set>
            nombre = #{nombre}, 
            apellidoPaterno = #{apellidoPaterno}, 
            apellidoMaterno = #{apellidoMaterno}, 
            curp = #{curp}, 
            telefono = #{telefono}, 
            foto = #{foto}, 
            numeroLicencia = #{numeroLicencia}, 
            idSucursal = #{idSucursal} 

            <if test="password != null and password != ''">
                , password = #{password} 
            </if>
        </set>
        WHERE idColaborador = #{idColaborador} 
    </update>

    <!-- ============================= -->
    <!-- ELIMINAR                      -->
    <!-- ============================= -->
    <delete id="eliminar-colaborador" parameterType="int">
        DELETE FROM Colaborador 
        WHERE idColaborador = #{idColaborador}
    </delete>

    <!-- ============================= -->
    <!-- BUSCAR POR NOMBRE             -->
    <!-- ============================= -->
    <select id="buscar-por-nombre" parameterType="string" resultType="pojo.Colaborador">
        SELECT * 
        FROM Colaborador 
        WHERE nombre LIKE CONCAT('%', #{_parameter}, '%') 
    </select>

    <!-- ============================= -->
    <!-- BUSCAR POR NO PERSONAL        -->
    <!-- ============================= -->
    <select id="buscar-por-noPersonal"
            parameterType="string"
            resultType="pojo.Colaborador">
        SELECT
        idColaborador,
        noPersonal,
        nombre,
        apellidoPaterno,
        apellidoMaterno,
        curp,
        correo,
        telefono,
        numeroLicencia,
        idRol,
        idSucursal 
        FROM Colaborador 
        WHERE noPersonal = #{noPersonal} 
    </select>


    <!-- ============================= -->
    <!-- BUSCAR POR ROL                -->
    <!-- ============================= -->
    <select id="buscar-por-rol" parameterType="int" resultType="pojo.Colaborador">
        SELECT * 
        FROM Colaborador 
        WHERE idRol = #{idRol}
    </select>

    <!-- ============================= -->
    <!-- ACTUALIZAR PERFIL (MÃ³vil)     -->
    <!-- ============================= -->
    <update id="actualizar-perfil" parameterType="pojo.Colaborador">
        UPDATE Colaborador 
        SET 
        nombre = #{nombre}, 
        apellidoPaterno = #{apellidoPaterno}, 
        apellidoMaterno = #{apellidoMaterno}, 
        curp = #{curp},
        correo = #{correo},
        telefono = #{telefono}, 
        numeroLicencia = #{numeroLicencia}
        WHERE idColaborador = #{idColaborador} 
    </update>

    <!-- ============================= -->
    <!-- LOGIN                         -->
    <!-- ============================= -->
    <select id="login-colaborador" parameterType="map" resultType="pojo.Colaborador">
        SELECT c.idColaborador, c.noPersonal, c.nombre, c.apellidoPaterno, c.apellidoMaterno, 
        c.curp, c.correo, c.telefono, c.foto, c.numeroLicencia, c.idRol,
        r.nombre AS nombreRol, 
        c.idSucursal 
        FROM Colaborador c 
        INNER JOIN Rol r ON c.idRol = r.idRol 
        WHERE c.noPersonal = #{noPersonal} 
        AND c.password = #{password} 
    </select>
    
    <select id="buscar-datos-perfil" parameterType="int" resultType="pojo.Colaborador">
        SELECT 
        nombre, 
        apellidoPaterno, 
        apellidoMaterno, 
        curp, 
        correo, 
        telefono, 
        numeroLicencia
        FROM 
        Colaborador
        WHERE 
        idColaborador = #{idColaborador}
    </select>
    
    <select id="obtener-password-actual" parameterType="int" resultType="pojo.Colaborador">
        SELECT password 
        FROM Colaborador
        WHERE idColaborador = #{idColaborador}
    </select>
    
    <update id="cambiar-password" parameterType="dto.RSCambioPassword"> 
        UPDATE Colaborador
        SET password = #{passwordNueva}
        WHERE idColaborador = #{idColaborador}
    </update>
    <!-- ============================= -->
    <!-- GUARDAR FOTO COLABORADOR      -->
    <!-- ============================= -->
    <update id="guardar-foto" parameterType="pojo.Colaborador">
        UPDATE Colaborador 
        SET foto = #{foto} 
        WHERE idColaborador = #{idColaborador}
    </update>

    <!-- ============================= -->
    <!-- OBTENER FOTO COLABORADOR      -->
    <!-- ============================= -->
    <select id="obtener-foto" parameterType="int" resultType="pojo.Colaborador">
        SELECT idColaborador, TO_BASE64(foto) AS foto
        FROM Colaborador
        WHERE idColaborador = #{idColaborador}
    </select>
    
    
    <!-- ============================= -->
    <!-- GUARDAR FOTO ESCRITORIO FX   -->
    <!-- ============================= -->
    <update id="guardar-foto-escritorio" parameterType="pojo.Colaborador">
        UPDATE Colaborador  
        SET foto = #{foto, jdbcType=BLOB} 
        WHERE idColaborador = #{idColaborador} 
    </update>

    <!-- ============================= -->
    <!-- OBTENER FOTO CLIENTE FX       -->
    <!-- ============================= -->
    <select id="obtener-foto-escritorio" parameterType="int" resultType="pojo.Colaborador">
        SELECT idColaborador, foto 
        FROM Colaborador 
        WHERE idColaborador = #{idColaborador} 
    </select>

</mapper>
