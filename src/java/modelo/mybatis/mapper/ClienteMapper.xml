<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cliente">
    
    <!-- ====================================================== -->
    <!-- RESULT MAP CLIENTE + DIRECCION                         -->
    <!-- ====================================================== -->
    <resultMap id="clienteDireccionRM" type="pojo.Cliente">

        <id property="idCliente" column="idCliente"/>
        <result property="nombre" column="nombre"/>
        <result property="apellidoPaterno" column="apellidoPaterno"/>
        <result property="apellidoMaterno" column="apellidoMaterno"/>
        <result property="telefono" column="telefono"/>
        <result property="correo" column="correo"/>
        <result property="idDireccion" column="idDireccion"/>

        <association property="direccion" javaType="pojo.Direccion">
            <id property="idDireccion" column="idDireccion"/>
            <result property="calle" column="calle"/>
            <result property="numero" column="numero"/>
            <result property="colonia" column="colonia"/>
            <result property="codigoPostal" column="codigoPostal"/>
            <result property="ciudad" column="ciudad"/>
            <result property="estado" column="estado"/>
        </association>

    </resultMap>
    
    <!-- ====================================================== -->
    <!-- OBTENER TODOS LOS CLIENTES                            -->
    <!-- ====================================================== -->
    <select id="obtener-todos" resultMap="clienteDireccionRM">
        SELECT 
        c.idCliente, c.nombre, c.apellidoPaterno, c.apellidoMaterno,  
        c.telefono, c.correo, c.idDireccion, 
        d.calle, d.numero, d.colonia, d.codigoPostal, d.ciudad, d.estado 
        FROM Cliente c 
        INNER JOIN Direccion d 
        ON c.idDireccion = d.idDireccion 
    </select> 

    <!-- ====================================================== -->
    <!-- INSERTAR CLIENTE                                       -->
    <!-- ====================================================== -->
    <insert id="insertar-cliente"
            parameterType="pojo.Cliente"
            useGeneratedKeys="true"
            keyProperty="idCliente">
        INSERT INTO Cliente ( 
        nombre, apellidoPaterno, apellidoMaterno, telefono, correo, idDireccion  
        ) VALUES ( 
        #{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, #{telefono}, #{correo}, #{idDireccion}
        )
    </insert>

    <!-- ====================================================== -->
    <!-- ACTUALIZAR CLIENTE                                     -->
    <!-- ====================================================== -->
    <update id="actualizar-cliente" parameterType="pojo.Cliente">
        UPDATE Cliente SET 
        nombre = #{nombre}, 
        apellidoPaterno = #{apellidoPaterno}, 
        apellidoMaterno = #{apellidoMaterno}, 
        telefono = #{telefono}, 
        correo = #{correo}, 
        idDireccion = #{idDireccion} 
        WHERE idCliente = #{idCliente}
    </update>

    <!-- ====================================================== -->
    <!-- ELIMINAR CLIENTE                                       -->
    <!-- ====================================================== -->
    <delete id="eliminar-cliente" parameterType="int">
        DELETE FROM Cliente 
        WHERE idCliente = #{idCliente} 
    </delete>

    <!-- ====================================================== -->
    <!-- BUSCAR CLIENTE POR NOMBRE                              -->
    <!-- ====================================================== -->
    <select id="buscar-por-nombre" parameterType="string" resultType="pojo.Cliente">
        SELECT * 
        FROM Cliente 
        WHERE nombre LIKE CONCAT('%', #{param}, '%') 
        OR apellidoPaterno LIKE CONCAT('%', #{param}, '%') 
        OR apellidoMaterno LIKE CONCAT('%', #{param}, '%')
    </select>

    <!-- ====================================================== -->
    <!-- BUSCAR CLIENTE POR TELÃ‰FONO                            -->
    <!-- ====================================================== -->
    <select id="buscar-por-telefono" parameterType="string" resultType="pojo.Cliente">
        SELECT * 
        FROM Cliente 
        WHERE telefono LIKE CONCAT('%', #{param}, '%')
    </select>

    <!-- ====================================================== -->
    <!-- BUSCAR CLIENTE POR CORREO                              -->
    <!-- ====================================================== -->
    <select id="buscar-por-correo" parameterType="string" resultType="pojo.Cliente">
        SELECT * 
        FROM Cliente 
        WHERE correo LIKE CONCAT('%', #{param}, '%')
    </select>
</mapper>
